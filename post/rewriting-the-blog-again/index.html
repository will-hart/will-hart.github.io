<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Optimising time to interactive, or rewriting my blog... again | willhart.io</title>


  <link rel="icon" type="image/x-icon" href="/icons/icon_light_32x32.png">

  
<meta name="description" content="What started out as experimenting with reducing the time to interactive resulted in me rewriting the blog... again. This time I&#x27;ve migrated to Zola.. Posted on https://willhart.io" />
<meta property="og:description" content="What started out as experimenting with reducing the time to interactive resulted in me rewriting the blog... again. This time I&#x27;ve migrated to Zola." />
<meta property="og:title" content="Optimising time to interactive, or rewriting my blog... again" />
<meta property="og:url" content="https://willhart.io/post/rewriting-the-blog-again/">
<meta property="og:type" content="article" />
<meta property="og:locale" content="en_AU" />


  <link rel="stylesheet" href="https://willhart.io/global.css?h=f83cd20cd0df26d72c2b" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sono:wght@200..800&display=swap" rel="stylesheet">

  

  <!-- Cloudflare Web Analytics -->
  <script defer src='https://static.cloudflareinsights.com/beacon.min.js'
    data-cf-beacon='{"token": "310f93cab66a42c5a328f246cc053025"}'></script>
  <!-- End Cloudflare Web Analytics -->

  <!-- Light/Dark theme toggling -->
  <script type="text/javascript">
    const storageKey = "websiteTheme";

    // apply theme once we have a DOM
    document.addEventListener("DOMContentLoaded", () => {
      applyTheme();
    })

    // a function that toggles between light and dark theme
    const toggleTheme = () => {
      localStorage.setItem(storageKey, localStorage.getItem(storageKey) === "d" ? "l" : "d" );
      applyTheme();
    }

    // a function that actually applies the theme
    const applyTheme = () => {
      const useDarkTheme = localStorage.getItem(storageKey) === "d";
      document.getElementsByTagName("html")[0].className = useDarkTheme ? "dark" : "";
      document.getElementById("theme-toggle").textContent = useDarkTheme ? "üîÜ" : "üåë";
    }
  </script>

  <script type="speculationrules">
  {
    "prerender": [
      { "where": { "selector_matches": "a" } }
    ]
  }
  </script></head>

<body>
  <nav id="header">
    <a href="/" aria-label="Website Logo and Link to Home Page">
      <div id="logo" >&nbsp;</div>
    </a>
    <span>
      <button type="button" id="theme-toggle" aria-label="Toggle Theme" onClick="toggleTheme()">üåë</button>
      <a class="header-item" href="/post">POSTS</a>
      <a class="header-item" href="/tag">TAGS</a>
      <span class="header-item hide-when-slim">|</span>
      <a class="header-item hide-when-slim" href="/tag/projects">PROJECTS</a>
      <a class="header-item hide-when-slim" href="/tag/gamedev">GAMEDEV</a>
      <a class="header-item hide-when-slim" href="/tag/electronics">ELECTRONICS</a>
    </span>
  </nav>

  

<div class="container col mb mt">
  <h1>Optimising time to interactive, or rewriting my blog... again</h1>
  <div class="col txtsm">
    <span>Posted by Will Hart on 2022-01-22</span>
    <div>
      <span>See also:</span>
      
      <a class="txtsm mr" href="https://willhart.io/tag/code/">#code</a>
      
      <a class="txtsm mr" href="https://willhart.io/tag/random/">#random</a>
      
    </div>
  </div>
</div>



<article class="container col mblg"><p>I seem to have a habit of rewriting this blog every time I get bored, but this time I swear I didn‚Äôt do it on purpose! On the plus side, rewriting the blog is a good way to try out new things and different deployment strategies. On the negative side, it often takes over a weekend and I don‚Äôt get much else done!</p>
<p>Over time I‚Äôve evolved from <a href="https://willhart.io/post/a-simple-static-site-generator-in-python/">a custom static site generator</a>, to a <a href="https://willhart.io/post/switched-to-ghost/">self-hosted ghost instance</a>, then most recently to <a href="https://willhart.io/post/recreating-the-blog-in-nextjs/">next.js</a>.</p>
<h2 id="it-started-with-lighthouse">It started with lighthouse</h2>
<p>I posted about my <a href="https://willhart.io/post/cmos-analog-clock/">CMOS analog clock</a> the other day and on a whim I ran a <a rel="noopener nofollow noreferrer" target="_blank" href="https://developers.google.com/web/tools/lighthouse">lighthouse</a> report on the site. I was surprised to see this in ‚Äúmobile‚Äù mode:</p>
<p><img src="https://willhart.io/post/rewriting-the-blog-again/nextjs_lighthouse.png" alt="The Lighthouse report for the NextJS blog in ‚Äúmobile‚Äù mode" /></p>
<p>The ‚Äútime to interactive‚Äù in particular was a bit of a surprise. On desktop its about 1s, but here its approximately a thousand years. One of the strengths of NextJS is how easy it makes it to do server side rendering (SSR) and server side generation (SSG). I‚Äôd spent quite a lot of time messing about with SSG and built it into a custom markdown to SSG pipeline in NextJS. Lighthouse seemed to suggest that bundle size was the big issue. I ran the profiler quickly and I‚Äôm definitely not an expert, but with simulating a ‚ÄúFast 3G‚Äù connection and ‚Äú4x CPU slowdown‚Äù the best I could tell was it spent about 3 seconds loading the bundle and another 2 seconds rendering.</p>
<p>I tried a few different things to reduce bundle size, including <a rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/will-hart/willhart.io/commit/af7a0097881aaa3feea5d103c6a547088d28a61c">replacing some CSS</a> and <a rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/will-hart/willhart.io/commit/f302453b4030be5227201a8d7d6c2a521c57d4ab">dynamically loading components</a> but nothing really made a dent. <a rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/will-hart/willhart.io/commit/3097e3fe11f8dc1d5aee51e714daeea8946b2151">Using Next‚Äôs image optimisation</a> was more successful and seemed to make a huge difference to the bandwidth for more image heavy posts, but time to interactive was still fairly low.</p>
<p>These seemed to make a bit of difference in some respects, in particular I think Next‚Äôs image optimisation was making a huge difference. Overall time to interactive was still about 4-5 seconds probably due to a decent sized JS bundle and the time spent spinning up the javascript.</p>
<p><img src="https://willhart.io/post/rewriting-the-blog-again/nextjs_lighthouse_after_optimisation.png" alt="The Lighthouse report in ‚Äúmobile‚Äù mode after trying a few different tweaks to bundle size" /></p>
<h2 id="looking-at-zola">Looking at Zola</h2>
<p>I decided to run a quick proof-of-concept to compare to a pure static site generator. I chose <a rel="noopener nofollow noreferrer" target="_blank" href="https://getzola.com">zola</a>, which is a rust-based static site generator that is quite straighforward to use. Like most rust things, speed seems to be a big consideration and builds are definitely very speedy (this site takes about 300-500ms to build from scratch).</p>
<p>To get started without setting up an entire pipeline, I copied the minified CSS from the NextJS production site and quickly converted a few markdown articles to the Zola format (mostly just changing the front matter to <code>TOML</code>). The lighthouse report for Zola was green across the board.</p>
<p><img src="https://willhart.io/post/rewriting-the-blog-again/zola_lighthouse.png" alt="The first lighthouse report for" /></p>
<p>The Zola page definitely renders a lot faster, which is a combination of smaller bundle size and not having to spin up the NextJS javascript on the client side. However looking at total downloads things get a bit more interesting. The table below shows the total download size (in MB) for two posts, one very image heavy and one text/code heavy.</p>
<table><thead><tr><th></th><th>NextJS Unoptimised</th><th>NextJS Optimised</th><th>Zola</th></tr></thead><tbody>
<tr><td>CMOS Clock</td><td>4.6 MB</td><td>2.1 MB</td><td>4.1 MB</td></tr>
<tr><td>NextJS rewrite</td><td>1 MB</td><td>1 MB</td><td>0.006 MB</td></tr>
</tbody></table>
<p>Zola absolutely smashes NextJS on text heavy pages, but gets beaten on image-heavy pages thanks to Next‚Äôs image optimisation. Zola does have some support for <a rel="noopener nofollow noreferrer" target="_blank" href="https://www.getzola.org/documentation/content/image-processing/">optimising images</a> which might be useful in closing the gap.</p>
<h2 id="did-it-make-a-difference">Did it make a difference?</h2>
<p>Overall I think the Zola website will load and become interactive much faster, but without some serious image optimisation it might not have much benefit for more image-heavy posts. NextJS is a fantastic framework, but in this case where I don‚Äôt really need interactivity and I just want to serve HTML blog pages, then I‚Äôll be migrating to Zola.</p>
</article>

<div class="container col">
  <h2>Comments</h2>
  <blockquote>Comments are powered by github and <a href="https://giscus.app">giscus</a></blockquote>
  <script src="https://giscus.app/client.js"
        data-repo="will-hart/will-hart.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzMjQ2NjY3Mzg="
        data-category="General"
        data-category-id="DIC_kwDOE1oFcs4CtiK6"
        data-mapping="og:title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
  </script>
</div>
</div>

  <footer id="footer">
    <div class="container col">
      This website was hand-made using Zola and Tera.
      All text and images are available under CC0 1.0 Universal and code under MIT unless otherwise specified. See <a href="https://github.com/will-hart/willhart.io/blob/main/LICENSE.md">LICENSE.md</a> for more.
    </div>
  </footer>
</body>

</html>
