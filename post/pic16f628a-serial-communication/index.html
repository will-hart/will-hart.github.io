<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>PIC16F628A Serial Communication | willhart.io</title>


  <link rel="icon" type="image/x-icon" href="/icons/icon_light_32x32.png">

  
<meta name="description" content="A tutorial on getting serial communication working using a PIC16F628A microcontroller. Posted on https://willhart.io" />
<meta property="og:description" content="A tutorial on getting serial communication working using a PIC16F628A microcontroller" />
<meta property="og:title" content="PIC16F628A Serial Communication" />
<meta property="og:url" content="https://willhart.io/post/pic16f628a-serial-communication/">
<meta property="og:type" content="article" />
<meta property="og:locale" content="en_AU" />


  <link rel="stylesheet" href="https://willhart.io/global.css?h=f83cd20cd0df26d72c2b" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sono:wght@200..800&display=swap" rel="stylesheet">

  

  <!-- Cloudflare Web Analytics -->
  <script defer src='https://static.cloudflareinsights.com/beacon.min.js'
    data-cf-beacon='{"token": "310f93cab66a42c5a328f246cc053025"}'></script>
  <!-- End Cloudflare Web Analytics -->

  <!-- Light/Dark theme toggling -->
  <script type="text/javascript">
    const storageKey = "websiteTheme";

    // apply theme once we have a DOM
    document.addEventListener("DOMContentLoaded", () => {
      applyTheme();
    })

    // a function that toggles between light and dark theme
    const toggleTheme = () => {
      localStorage.setItem(storageKey, localStorage.getItem(storageKey) === "d" ? "l" : "d" );
      applyTheme();
    }

    // a function that actually applies the theme
    const applyTheme = () => {
      const useDarkTheme = localStorage.getItem(storageKey) === "d";
      document.getElementsByTagName("html")[0].className = useDarkTheme ? "dark" : "";
      document.getElementById("theme-toggle").textContent = useDarkTheme ? "ðŸ”†" : "ðŸŒ‘";
    }
  </script>

  <script type="speculationrules">
  {
    "prerender": [
      { "where": { "selector_matches": "a" } }
    ]
  }
  </script></head>

<body>
  <nav id="header">
    <a href="/" aria-label="Website Logo and Link to Home Page">
      <div id="logo" >&nbsp;</div>
    </a>
    <span>
      <button type="button" id="theme-toggle" aria-label="Toggle Theme" onClick="toggleTheme()">ðŸŒ‘</button>
      <a class="header-item" href="/post">POSTS</a>
      <a class="header-item" href="/tag">TAGS</a>
      <span class="header-item hide-when-slim">|</span>
      <a class="header-item hide-when-slim" href="/tag/projects">PROJECTS</a>
      <a class="header-item hide-when-slim" href="/tag/gamedev">GAMEDEV</a>
      <a class="header-item hide-when-slim" href="/tag/electronics">ELECTRONICS</a>
    </span>
  </nav>

  

<div class="container col mb mt">
  <h1>PIC16F628A Serial Communication</h1>
  <div class="col txtsm">
    <span>Posted by Will Hart on 2012-01-14</span>
    <div>
      <span>See also:</span>
      
      <a class="txtsm mr" href="https://willhart.io/tag/tutorials/">#tutorials</a>
      
      <a class="txtsm mr" href="https://willhart.io/tag/electronics/">#electronics</a>
      
    </div>
  </div>
</div>



<article class="container col mblg"><p>Serial communication is used extensively in electronics projects, and many
microcontrollers come with some form of USART on board. Iâ€™m going to describe
here how I got PIC USART serial communication working with a PIC16F628A, and got
the PIC talking to an Arduino Uno. For this Iâ€™m using a PICKIT2, my own
PIC16F628A breakout board and MicroC compiler because it has a handy serial
library all built in. If you are using MPLAB or some other development tool, you
can find the locations of the relevant registers in the datasheets for <code>TXSTA</code> and
<code>RCSTA</code>.</p>
<h2 id="the-code">The Code</h2>
<p>The code itself is very simple - most of the setup is done using two registers -
<code>TXSTA</code> and <code>RCSTA</code>. There are three main steps in setting up serial transmission on
the PIC16F628A:</p>
<ol>
<li>Enable serial communication</li>
<li>Set up the communication mode</li>
<li>Set the baud rate</li>
</ol>
<p>The best source of information is (of course) the datasheet, howeverâ€¦ to
enable serial communication we set (i.e. make equal to 1) <code>TXSTA.TXEN</code> and
<code>RCSTA.SPEN</code>.</p>
<p>We then set to 8 bit mode (there is quite a bit of information in the datasheet
about 9 bit mode, but for this simple example probably not relevant) by clearing
<code>TXSTA.TX9</code> and <code>RCSTA.RX9</code> (i.e. making equal to 0). The 16F628A can run in
either synchronous or asynchronous serial modes, but here we set asynchronous by
clearing <code>TXSTA.SYNC</code>.</p>
<pre data-lang="c" style="background-color:#2b303b;color:#c0c5ce;" class="language-c "><code class="language-c" data-lang="c"><span style="color:#b48ead;">void </span><span style="color:#8fa1b3;">main</span><span>() {
</span><span>
</span><span>     </span><span style="color:#65737e;">// some standard PIC16F628A configuration
</span><span>     TRISA = </span><span style="color:#d08770;">0x00</span><span>;   </span><span style="color:#65737e;">// output
</span><span>     TRISB = </span><span style="color:#d08770;">0xFF</span><span>;   </span><span style="color:#65737e;">// input
</span><span>     PORTA = </span><span style="color:#d08770;">0x00</span><span>;   </span><span style="color:#65737e;">// set PORTA to off
</span><span>     CMCON = </span><span style="color:#d08770;">0x07</span><span>;   </span><span style="color:#65737e;">// turn off comparators by setting the last three bits to 111
</span><span>
</span><span>     </span><span style="color:#65737e;">// Step 1, enable USART
</span><span>     TXSTA.</span><span style="color:#bf616a;">TXEN </span><span>= </span><span style="color:#d08770;">1</span><span>; </span><span style="color:#65737e;">// transmission enabled
</span><span>     RCSTA.</span><span style="color:#bf616a;">SPEN </span><span>= </span><span style="color:#d08770;">1</span><span>; </span><span style="color:#65737e;">// enable serial port
</span><span>
</span><span>     </span><span style="color:#65737e;">// Step 2, Set 8 bit, asynchronous continuous mode
</span><span>     TXSTA.</span><span style="color:#bf616a;">TX9 </span><span>= </span><span style="color:#d08770;">0</span><span>;  </span><span style="color:#65737e;">// 8 bit transmission
</span><span>     RCSTA.</span><span style="color:#bf616a;">RX9 </span><span>= </span><span style="color:#d08770;">0</span><span>;  </span><span style="color:#65737e;">// 8 bit reception
</span><span>     TXSTA.</span><span style="color:#bf616a;">SYNC </span><span>= </span><span style="color:#d08770;">0</span><span>; </span><span style="color:#65737e;">// asynchronous mode
</span><span>     RCSTA.</span><span style="color:#bf616a;">CREN </span><span>= </span><span style="color:#d08770;">1</span><span>; </span><span style="color:#65737e;">// enable continuous receive mode
</span><span>
</span><span>     </span><span style="color:#65737e;">// Step 3, Set the baud rate using the built in baud rate generator
</span><span>     TXSTA.</span><span style="color:#bf616a;">BRGH </span><span>= </span><span style="color:#d08770;">1</span><span>; </span><span style="color:#65737e;">// set baud rate generator high
</span><span>     SPBRG = </span><span style="color:#d08770;">0</span><span style="background-color:#bf616a;color:#2b303b;">b00011001</span><span>; </span><span style="color:#65737e;">// set the baud rate to 9600kb, Asynchronous mode BTGH=1
</span><span>
</span><span>     </span><span style="color:#65737e;">// initialise the library and wait for it to start
</span><span>     </span><span style="color:#bf616a;">UART1_Init</span><span>(</span><span style="color:#d08770;">9600</span><span>);
</span><span>     </span><span style="color:#bf616a;">Delay_ms</span><span>(</span><span style="color:#d08770;">100</span><span>);
</span><span>
</span><span>     </span><span style="color:#65737e;">// ok, now some dummy code... (loop forever and ever and ever and ...)
</span><span>     </span><span style="color:#65737e;">// just send some information every second
</span><span>     </span><span style="color:#b48ead;">do
</span><span>     {
</span><span>         </span><span style="color:#bf616a;">UART1_Write_Text</span><span>(&quot;</span><span style="color:#a3be8c;">Sending some text</span><span>&quot;);
</span><span>         </span><span style="color:#bf616a;">Delay_ms</span><span>(</span><span style="color:#d08770;">1000</span><span>); </span><span style="color:#65737e;">// wait one second
</span><span>     } </span><span style="color:#b48ead;">while</span><span>(</span><span style="color:#d08770;">1</span><span>);
</span><span>}
</span></code></pre>
<p>I then built a very basic Arduino sketch, from memory (and untested) something
along the lines of:</p>
<pre data-lang="c" style="background-color:#2b303b;color:#c0c5ce;" class="language-c "><code class="language-c" data-lang="c"><span style="color:#b48ead;">void </span><span style="color:#8fa1b3;">setup</span><span>() {
</span><span>        Serial.</span><span style="color:#bf616a;">begin</span><span>(</span><span style="color:#d08770;">9600</span><span>);
</span><span>}
</span><span>
</span><span style="color:#b48ead;">void </span><span style="color:#8fa1b3;">loop</span><span>() {
</span><span>        </span><span style="color:#b48ead;">while</span><span>(Serial.</span><span style="color:#bf616a;">available</span><span>() &gt; </span><span style="color:#d08770;">0</span><span>) {
</span><span>         Serial.</span><span style="color:#bf616a;">write</span><span>(Serial.</span><span style="color:#bf616a;">read</span><span>());
</span><span>        }
</span><span>}
</span></code></pre>
<h2 id="what-happens">What happens?</h2>
<p>Wire up the RX and TX ports from the PIC16F628A to the TX and RX ports of the
Arduino. Compile the sketch, program the PIC and then open up the Arduino serial
monitor. Every second or so you should see a message appear on the serial
monitorâ€¦ <code>Sending some text</code>. There you go - your first serial communication!</p>
</article>

<div class="container col">
  <h2>Comments</h2>
  <blockquote>Comments are powered by github and <a href="https://giscus.app">giscus</a></blockquote>
  <script src="https://giscus.app/client.js"
        data-repo="will-hart/will-hart.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzMjQ2NjY3Mzg="
        data-category="General"
        data-category-id="DIC_kwDOE1oFcs4CtiK6"
        data-mapping="og:title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
  </script>
</div>
</div>

  <footer id="footer">
    <div class="container col">
      This website was hand-made using Zola and Tera.
      All text and images are available under CC0 1.0 Universal and code under MIT unless otherwise specified. See <a href="https://github.com/will-hart/willhart.io/blob/main/LICENSE.md">LICENSE.md</a> for more.
    </div>
  </footer>
</body>

</html>
